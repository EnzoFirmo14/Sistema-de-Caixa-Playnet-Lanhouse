<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Caixa - Gráfica</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--primary);
        }
        
        .sidebar {
            background-color: var(--dark);
            color: white;
            height: calc(100vh - 56px);
            position: fixed;
            width: 250px;
            padding-top: 20px;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link {
            color: rgba(35, 35, 35, 0.8);
            padding: 12px 20px;
            margin: 4px 0;
            border-radius: 4px;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .collapsed .sidebar {
            margin-left: -250px;
        }
        
        .collapsed .main-content {
            margin-left: 0;
        }
        
        .card-dashboard {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .card-dashboard:hover {
            transform: translateY(-5px);
        }
        
        .stats-icon {
            font-size: 2.5rem;
            opacity: 0.7;
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: #1a252f;
            border-color: #1a252f;
        }
        
        .btn-danger {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }
        
        .table th {
            background-color: var(--primary);
            color: white;
        }
        
        .product-card {
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .product-card:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .cart-item {
            border-left: 4px solid var(--accent);
            padding-left: 10px;
            margin-bottom: 10px;
        }
        
        .section-title {
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--dark);
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, #3498db 100%);
        }
        
        .login-card {
            width: 400px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                margin-left: 0;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .collapsed .sidebar {
                margin-left: -100%;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Simulação de banco de dados com localStorage
        const initializeData = () => {
            if (!localStorage.getItem('graphica_users')) {
                const users = [
                    { id: 1, username: 'admin', password: 'admin123', name: 'Administrador', role: 'admin' },
                    { id: 2, username: 'vendedor', password: 'vendedor123', name: 'Vendedor', role: 'vendedor' }
                ];
                localStorage.setItem('graphica_users', JSON.stringify(users));
            }
            
            // Atualizar a inicialização dos produtos
            if (!localStorage.getItem('graphica_products')) {
                const products = [
                    { id: 1, name: "Cartão de Visita", price: 35.00 },
                    { id: 2, name: "Flyer A5", price: 120.00 },
                    { id: 3, name: "Banner 90x200", price: 85.00 },
                    { id: 4, name: "Convite 10x15", price: 55.00 },
                    { id: 5, name: "Panfleto A4", price: 150.00 },
                    { id: 6, name: "Adesivo Personalizado", price: 75.00 },
                    { id: 7, name: "Outros", price: 0.00 } // Produto "Outros" sempre disponível
                ];
                localStorage.setItem('graphica_products', JSON.stringify(products));
            }
            
            if (!localStorage.getItem('graphica_clients')) {
                const clients = [
                    { id: 1, name: "João Silva", email: "joao@email.com", phone: "(11) 99999-9999", address: "Rua A, 123" },
                    { id: 2, name: "Maria Santos", email: "maria@email.com", phone: "(11) 98888-8888", address: "Av. B, 456" },
                    { id: 3, name: "Empresa XYZ", email: "contato@xyz.com", phone: "(11) 97777-7777", address: "Rua C, 789" }
                ];
                localStorage.setItem('graphica_clients', JSON.stringify(clients));
            }
            
            if (!localStorage.getItem('graphica_sales')) {
                localStorage.setItem('graphica_sales', JSON.stringify([]));
            }
            
            if (!localStorage.getItem('graphica_caixa_status')) {
                localStorage.setItem('graphica_caixa_status', JSON.stringify(false));
            }
            
            if (!localStorage.getItem('graphica_registros_caixa')) {
                localStorage.setItem('graphica_registros_caixa', JSON.stringify([]));
            }
        };

        // Funções de acesso aos dados
        const getData = (key) => {
            return JSON.parse(localStorage.getItem(key) || '[]');
        };

        const saveData = (key, data) => {
            localStorage.setItem(key, JSON.stringify(data));
        };

        // Componente de Login
const Login = ({ onLogin }) => {
    const [username, setUsername] = React.useState('');
    const [password, setPassword] = React.useState('');
    const [error, setError] = React.useState('');

    const handleSubmit = (e) => {
        e.preventDefault();
        const users = getData('graphica_users');
        const user = users.find(u => u.username === username && u.password === password);
        
        if (user) {
            setError('');
            onLogin(user);
        } else {
            setError('Usuário ou senha inválidos');
        }
    };

    return (
        <div className="login-container">
            <div className="card login-card">
                <div className="card-body p-5">
                    <div className="text-center mb-4">
                        <i className="bi bi-printer-fill text-primary" style={{fontSize: '2.5rem'}}></i>
                        <h3 className="mt-2">Sistema de Caixa - Gráfica</h3>
                        <p className="text-muted">Faça login para continuar</p>
                    </div>
                    
                    {error && (
                        <div className="alert alert-danger" role="alert">
                            {error}
                        </div>
                    )}
                    
                    <form onSubmit={handleSubmit}>
                        <div className="mb-3">
                            <label htmlFor="username" className="form-label">Usuário</label>
                            <input 
                                type="text" 
                                className="form-control" 
                                id="username"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                required
                            />
                        </div>
                        <div className="mb-3">
                            <label htmlFor="password" className="form-label">Senha</label>
                            <input 
                                type="password" 
                                className="form-control" 
                                id="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                            />
                        </div>
                        <button type="submit" className="btn btn-primary w-100">Entrar</button>
                    </form>
                </div>
            </div>
        </div>
    );
};

        // Componentes principais
        const Navbar = ({ user, onToggleSidebar, onLogout }) => {
            return (
                <nav className="navbar navbar-expand-lg navbar-dark">
                    <div className="container-fluid">
                        <button className="btn btn-sm btn-outline-light me-2" onClick={onToggleSidebar}>
                            <i className="bi bi-list"></i>
                        </button>
                        <span className="navbar-brand">
                            <i className="bi bi-printer-fill me-2"></i>
                            Sistema de Caixa - Gráfica Express
                        </span>
                        <div className="d-flex">
                            <span className="text-white me-3">
                                <i className="bi bi-person-circle me-1"></i> {user.name}
                            </span>
                            <button className="btn btn-outline-light btn-sm" onClick={onLogout}>
                                <i className="bi bi-box-arrow-right"></i> Sair
                            </button>
                        </div>
                    </div>
                </nav>
            );
        };

        const Sidebar = ({ activeSection, setActiveSection, isCollapsed, user }) => {

const menuItems = [
    { id: 'dashboard', label: 'Dashboard', icon: 'bi-speedometer2', roles: ['admin', 'vendedor'] },
    { id: 'caixa', label: 'Caixa', icon: 'bi-cash-stack', roles: ['admin', 'vendedor'] },
    { id: 'vendas', label: 'Nova Venda', icon: 'bi-cart-plus', roles: ['admin', 'vendedor'] },
    { id: 'produtos', label: 'Produtos', icon: 'bi-tag', roles: ['admin', 'vendedor'] },
    { id: 'relatorio-caixa', label: 'Relatório Caixa', icon: 'bi-journal-text', roles: ['admin'] },
    { id: 'relatorios', label: 'Relatórios', icon: 'bi-graph-up', roles: ['admin'] },
    { id: 'configuracoes', label: 'Configurações', icon: 'bi-gear', roles: ['admin'] }
];

            const filteredMenuItems = menuItems.filter(item => item.roles.includes(user.role));

            return (
                <div className={`sidebar ${isCollapsed ? 'd-none d-md-block' : ''}`}>
                    <div className="d-flex flex-column p-3">
                        {filteredMenuItems.map(item => (
                            <button
                                key={item.id}
                                className={`nav-link text-start ${activeSection === item.id ? 'active' : ''}`}
                                onClick={() => setActiveSection(item.id)}
                            >
                                <i className={item.icon}></i> {item.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // Componentes de conteúdo
        const Dashboard = () => {
    const sales = getData('graphica_sales');
    const products = getData('graphica_products');
    const clients = getData('graphica_clients');
    
    const todaySales = sales.filter(sale => {
        const saleDate = new Date(sale.date);
        const today = new Date();
        return saleDate.toDateString() === today.toDateString();
    });
    
    const todayRevenue = todaySales.reduce((total, sale) => total + sale.total, 0);
    const totalClients = clients.length;
    const lowStockProducts = products.filter(p => p.stock < 10).length;
    
    React.useEffect(() => {
        // Gráfico de vendas dos últimos 7 dias
        const last7Days = [];
        for (let i = 6; i >= 0; i--) {
            const date = new Date();
            date.setDate(date.getDate() - i);
            last7Days.push(date.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'}));
        }
        
        const salesData = last7Days.map(day => {
            const daySales = sales.filter(sale => {
                const saleDate = new Date(sale.date).toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'});
                return saleDate === day;
            });
            return daySales.reduce((total, sale) => total + sale.total, 0);
        });
        
        const ctx = document.getElementById('salesChart');
        if (ctx) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: salesData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                drawBorder: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
    }, [sales]);

    return (
        <div>
            <h2 className="section-title">Dashboard</h2>
            
            <div className="row mb-4">
                <div className="col-md-3 mb-3">
                    <div className="card card-dashboard bg-white">
                        <div className="card-body">
                            <div className="d-flex justify-content-between">
                                <div>
                                    <h6 className="card-subtitle mb-2 text-muted">Vendas Hoje</h6>
                                    <h3 className="card-title">R$ {todayRevenue.toFixed(2)}</h3>
                                    <p className="card-text text-success">
                                        <small>{todaySales.length} vendas realizadas</small>
                                    </p>
                                </div>
                                <div className="text-primary">
                                    <i className="bi bi-currency-dollar stats-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div className="col-md-3 mb-3">
                    <div className="card card-dashboard bg-white">
                        <div className="card-body">
                            <div className="d-flex justify-content-between">
                                <div>
                                    <h6 className="card-subtitle mb-2 text-muted">Produtos</h6>
                                    <h3 className="card-title">{products.length}</h3>
                                    <p className="card-text text-success">
                                        <small>Produtos cadastrados</small>
                                    </p>
                                </div>
                                <div className="text-warning">
                                    <i className="bi bi-box-seam stats-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div className="col-md-3 mb-3">
                    <div className="card card-dashboard bg-white">
                        <div className="card-body">
                            <div className="d-flex justify-content-between">
                                <div>
                                    <h6 className="card-subtitle mb-2 text-muted">Vendas no Mês</h6>
                                    <h3 className="card-title">R$ {sales.reduce((total, sale) => total + sale.total, 0).toFixed(2)}</h3>
                                    <p className="card-text text-success">
                                        <small>Total mensal</small>
                                    </p>
                                </div>
                                <div className="text-info">
                                    <i className="bi bi-graph-up stats-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div className="col-md-3 mb-3">
                    <div className="card card-dashboard bg-white">
                        <div className="card-body">
                            <div className="d-flex justify-content-between">
                                <div>
                                    <h6 className="card-subtitle mb-2 text-muted">Status Caixa</h6>
                                    <h3 className="card-title">{getData('graphica_caixa_status') ? 'Aberto' : 'Fechado'}</h3>
                                    <p className="card-text text-success">
                                        <small>Status atual</small>
                                    </p>
                                </div>
                                <div className="text-success">
                                    <i className="bi bi-cash-stack stats-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div className="row">
                <div className="col-md-8 mb-4">
                    <div className="card">
                        <div className="card-header bg-white">
                            <h5 className="card-title">Vendas dos Últimos 7 Dias</h5>
                        </div>
                        <div className="card-body">
                            <canvas id="salesChart" height="250"></canvas>
                        </div>
                    </div>
                </div>
                
                <div className="col-md-4 mb-4">
                    <div className="card">
                        <div className="card-header bg-white">
                            <h5 className="card-title">Produtos Mais Vendidos</h5>
                        </div>
                        <div className="card-body">
                            <ul className="list-group list-group-flush">
                                {products.slice(0, 5).map(product => (
                                    <li key={product.id} className="list-group-item d-flex justify-content-between align-items-center">
                                        {product.name}
                                        <span className="badge bg-primary rounded-pill">R$ {product.price.toFixed(2)}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
};

                const Vendas = ({ user }) => {
                const [cart, setCart] = React.useState([]);
                const [products, setProducts] = React.useState(getData('graphica_products'));
                const [paymentMethod, setPaymentMethod] = React.useState('dinheiro');
                const [saleNote, setSaleNote] = React.useState('');

                                const addToCart = (product) => {
    if (product.name === 'Outros') {
        const customPrice = prompt('Digite o valor do produto:');
        if (customPrice && !isNaN(customPrice)) {
            const customProduct = {
                ...product,
                price: parseFloat(customPrice),
                name: 'Outros - Valor Manual'
            };
            setCart([...cart, { ...customProduct, quantity: 1 }]);
        }
    } else {
        const existingItem = cart.find(item => item.id === product.id);
        if (existingItem) {
            setCart(cart.map(item => 
                item.id === product.id 
                    ? { ...item, quantity: item.quantity + 1 } 
                    : item
            ));
        } else {
            setCart([...cart, { ...product, quantity: 1 }]);
        }
    }
};

            const removeFromCart = (id) => {
                setCart(cart.filter(item => item.id !== id));
            };

            const caixaAberto = getData('graphica_caixa_status');
    if (!caixaAberto) {
        alert('O caixa precisa estar aberto para realizar uma venda');
        return;
    }

           const updateQuantity = (id, quantity) => {
    if (quantity === 0) {
        removeFromCart(id);
    } else {
        setCart(cart.map(item => 
            item.id === id ? { ...item, quantity } : item
        ));
    }
};

            const getTotal = () => {
                return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            };

               const finalizeSale = () => {
        if (cart.length === 0) {
            alert('Adicione produtos ao carrinho antes de finalizar a venda');
            return;
        }

    // Verificar se o caixa está aberto
    const caixaAberto = getData('graphica_caixa_status');
        if (!caixaAberto) {
            alert('O caixa precisa estar aberto para realizar uma venda');
            return;
        }

    // Registrar venda
    const sales = getData('graphica_sales') || [];
        const newSale = {
            id: sales.length > 0 ? Math.max(...sales.map(s => s.id)) + 1 : 1,
            date: new Date().toISOString(),
            items: cart.map(item => ({
                id: item.id,
                name: item.name,
                price: item.price,
                quantity: item.quantity
            })),
            total: getTotal(),
            paymentMethod,
            note: saleNote,
            employee: user.name, // Adicionar o nome do funcionário
            employeeId: user.id   // Adicionar o ID do funcionário
        };
    
    // Salvar a venda
    saveData('graphica_sales', [...sales, newSale]);
    
    // Limpar carrinho e formulário
    setCart([]);
    setPaymentMethod('dinheiro');
    setSaleNote('');
    
    alert(`Venda finalizada com sucesso! Total: R$ ${getTotal().toFixed(2)}`);
};

            return (
                <div>
                    <h2 className="section-title">Nova Venda</h2>
                    
                    <div className="row">
                        <div className="col-md-8">
                            <div className="card mb-4">
                                <div className="card-header bg-white">
                                    <h5 className="card-title">Produtos</h5>
                                </div>
                                <div className="card-body">
                                    <div className="row">
                                        {products.map(product => (
                                            <div key={product.id} className="col-md-6 mb-3">
                                                <div 
                                                    className="card product-card"
                                                    onClick={() => addToCart(product)}
                                                    style={{ cursor: 'pointer' }}
                                                >
                                                    <div className="card-body">
                                                        <h6 className="card-title">{product.name}</h6>
                                                        <p className="card-text fw-bold text-primary">
                                                            R$ {product.price.toFixed(2)}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div className="col-md-4">
                            <div className="card mb-4">
                                <div className="card-header bg-white d-flex justify-content-between align-items-center">
                                    <h5 className="card-title mb-0">Carrinho</h5>
                                    <span className="badge bg-primary">{cart.length} itens</span>
                                </div>
                                <div className="card-body">
                                    {cart.length === 0 ? (
                                        <p className="text-muted">Nenhum produto no carrinho</p>
                                    ) : (
                                        <>
                                            {cart.map(item => (
                                                <div key={item.id} className="cart-item mb-3">
                                                    <div className="d-flex justify-content-between">
                                                        <h6>{item.name}</h6>
                                                        <button 
                                                            className="btn btn-sm btn-outline-danger"
                                                            onClick={() => removeFromCart(item.id)}
                                                        >
                                                            <i className="bi bi-trash"></i>
                                                        </button>
                                                    </div>
                                                    <div className="d-flex justify-content-between align-items-center mt-2">
                                                        <div className="input-group input-group-sm" style={{width: '100px'}}>
                                                            <button 
                                                                className="btn btn-outline-secondary"
                                                                onClick={() => updateQuantity(item.id, item.quantity - 1)}
                                                            >
                                                                -
                                                            </button>
                                                            <input 
                                                                type="number" 
                                                                className="form-control text-center" 
                                                                value={item.quantity}
                                                                onChange={(e) => updateQuantity(item.id, parseInt(e.target.value) || 0)}
                                                                min="1"
                                                            />
                                                            <button 
                                                                className="btn btn-outline-secondary"
                                                                onClick={() => updateQuantity(item.id, item.quantity + 1)}
                                                            >
                                                                +
                                                            </button>
                                                        </div>
                                                        <span className="fw-bold">R$ {(item.price * item.quantity).toFixed(2)}</span>
                                                    </div>
                                                </div>
                                            ))}
                                            
                                            <div className="mb-3">
                                                <label className="form-label">Forma de Pagamento</label>
                                                <select 
                                                    className="form-select"
                                                    value={paymentMethod}
                                                    onChange={(e) => setPaymentMethod(e.target.value)}
                                                >
                                                    <option value="dinheiro">Dinheiro</option>
                                                    <option value="cartao_credito">Cartão de Crédito</option>
                                                    <option value="cartao_debito">Cartão de Débito</option>
                                                    <option value="pix">PIX</option>
                                                    <option value="transferencia">Transferência</option>
                                                </select>
                                            </div>
                                            
                                            <div className="mb-3">
                                                <label className="form-label">Observações</label>
                                                <textarea 
                                                    className="form-control"
                                                    rows="2"
                                                    value={saleNote}
                                                    onChange={(e) => setSaleNote(e.target.value)}
                                                ></textarea>
                                            </div>
                                            
                                            <div className="border-top pt-3">
                                                <div className="d-flex justify-content-between fw-bold fs-5 mb-3">
                                                    <span>Total:</span>
                                                    <span>R$ {getTotal().toFixed(2)}</span>
                                                </div>
                                                
                                                <div className="d-grid gap-2">
                                                    <button className="btn btn-primary" onClick={finalizeSale}>
                                                        <i className="bi bi-currency-dollar me-2"></i> Finalizar Venda
                                                    </button>
                                                    <button className="btn btn-outline-secondary" onClick={() => setCart([])}>
                                                        <i className="bi bi-x-circle me-2"></i> Cancelar
                                                    </button>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

const Produtos = () => {
    const [products, setProducts] = React.useState(getData('graphica_products') || []);
    const [editingProduct, setEditingProduct] = React.useState(null);
    const [showModal, setShowModal] = React.useState(false);
    const [formData, setFormData] = React.useState({
        name: '',
        price: ''
    });

    const handleEdit = (product) => {
        setEditingProduct(product);
        setFormData({
            name: product.name,
            price: product.price.toString()
        });
        setShowModal(true);
    };

    const handleDelete = (id) => {
        if (window.confirm('Tem certeza que deseja excluir este produto?')) {
            const updatedProducts = products.filter(p => p.id !== id);
            setProducts(updatedProducts);
            saveData('graphica_products', updatedProducts);
        }
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        
        if (editingProduct) {
            // Editar produto existente
            const updatedProducts = products.map(p => 
                p.id === editingProduct.id 
                    ? { 
                        ...p, 
                        ...formData, 
                        price: parseFloat(formData.price) 
                    }
                    : p
            );
            setProducts(updatedProducts);
            saveData('graphica_products', updatedProducts);
        } else {
            // Adicionar novo produto
            const newProduct = {
                id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
                ...formData,
                price: parseFloat(formData.price)
            };
            const updatedProducts = [...products, newProduct];
            setProducts(updatedProducts);
            saveData('graphica_products', updatedProducts);
        }
        
        setShowModal(false);
        setEditingProduct(null);
        setFormData({
            name: '',
            price: ''
        });
    };

    const handleChange = (e) => {
        setFormData({
            ...formData,
            [e.target.name]: e.target.value
        });
    };

    return (
        <div>
            <h2 className="section-title">Gestão de Produtos</h2>
            
            <div className="d-flex justify-content-between mb-4">
                <input type="text" className="form-control me-2" placeholder="Buscar produto..." style={{maxWidth: '300px'}} />
                <button 
                    className="btn btn-primary"
                    onClick={() => {
                        setEditingProduct(null);
                        setFormData({ name: '', price: '' });
                        setShowModal(true);
                    }}
                >
                    <i className="bi bi-plus-circle me-2"></i> Novo Produto
                </button>
            </div>
            
            <div className="card">
                <div className="card-body">
                    <div className="table-responsive">
                        <table className="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Preço</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {products.map(product => (
                                    <tr key={product.id}>
                                        <td>{product.id}</td>
                                        <td>{product.name}</td>
                                        <td>R$ {product.price?.toFixed(2)}</td>
                                        <td>
                                            {product.name !== 'Outros' && (
                                                <>
                                                    <button 
                                                        className="btn btn-sm btn-outline-primary me-1"
                                                        onClick={() => handleEdit(product)}
                                                    >
                                                        <i className="bi bi-pencil"></i>
                                                    </button>
                                                    <button 
                                                        className="btn btn-sm btn-outline-danger"
                                                        onClick={() => handleDelete(product.id)}
                                                    >
                                                        <i className="bi bi-trash"></i>
                                                    </button>
                                                </>
                                            )}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            {/* Modal simplificado */}
            {showModal && (
                <div className="modal fade show" style={{display: 'block', backgroundColor: 'rgba(0,0,0,0.5)'}}>
                    <div className="modal-dialog">
                        <div className="modal-content">
                            <div className="modal-header">
                                <h5 className="modal-title">
                                    {editingProduct ? 'Editar Produto' : 'Novo Produto'}
                                </h5>
                                <button type="button" className="btn-close" onClick={() => setShowModal(false)}></button>
                            </div>
                            <form onSubmit={handleSubmit}>
                                <div className="modal-body">
                                    <div className="mb-3">
                                        <label className="form-label">Nome do Produto</label>
                                        <input
                                            type="text"
                                            className="form-control"
                                            name="name"
                                            value={formData.name}
                                            onChange={handleChange}
                                            required
                                        />
                                    </div>
                                    <div className="mb-3">
                                        <label className="form-label">Preço (R$)</label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            className="form-control"
                                            name="price"
                                            value={formData.price}
                                            onChange={handleChange}
                                            required
                                        />
                                    </div>
                                </div>
                                <div className="modal-footer">
                                    <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>
                                        Cancelar
                                    </button>
                                    <button type="submit" className="btn btn-primary">
                                        {editingProduct ? 'Atualizar' : 'Criar'} Produto
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};

        const Clientes = () => {
            const [clients, setClients] = React.useState(getData('graphica_clients'));
            const [editingClient, setEditingClient] = React.useState(null);
            const [showModal, setShowModal] = React.useState(false);
            const [formData, setFormData] = React.useState({
                name: '',
                email: '',
                phone: '',
                address: ''
            });

            const handleEdit = (client) => {
                setEditingClient(client);
                setFormData({
                    name: client.name,
                    email: client.email,
                    phone: client.phone,
                    address: client.address
                });
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (window.confirm('Tem certeza que deseja excluir este cliente?')) {
                    const updatedClients = clients.filter(c => c.id !== id);
                    setClients(updatedClients);
                    saveData('graphica_clients', updatedClients);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (editingClient) {
                    // Editar cliente existente
                    const updatedClients = clients.map(c => 
                        c.id === editingClient.id 
                            ? { ...editingClient, ...formData }
                            : c
                    );
                    setClients(updatedClients);
                    saveData('graphica_clients', updatedClients);
                } else {
                    // Adicionar novo cliente
                    const newClient = {
                        id: clients.length > 0 ? Math.max(...clients.map(c => c.id)) + 1 : 1,
                        ...formData
                    };
                    const updatedClients = [...clients, newClient];
                    setClients(updatedClients);
                    saveData('graphica_clients', updatedClients);
                }
                
                setShowModal(false);
                setEditingClient(null);
                setFormData({
                    name: '',
                    email: '',
                    phone: '',
                    address: ''
                });
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <div>
                    <h2 className="section-title">Gestão de Clientes</h2>
                    
                    <div className="d-flex justify-content-between mb-4">
                        <input type="text" className="form-control me-2" placeholder="Buscar cliente..." style={{maxWidth: '300px'}} />
                        <button 
                            className="btn btn-primary"
                            onClick={() => {
                                setEditingClient(null);
                                setFormData({
                                    name: '',
                                    email: '',
                                    phone: '',
                                    address: ''
                                });
                                setShowModal(true);
                            }}
                        >
                            <i className="bi bi-person-plus me-2"></i> Novo Cliente
                        </button>
                    </div>
                    
                    <div className="card">
                        <div className="card-body">
                            <div className="table-responsive">
                                <table className="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nome</th>
                                            <th>Email</th>
                                            <th>Telefone</th>
                                            <th>Endereço</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {clients.map(client => (
                                            <tr key={client.id}>
                                                <td>{client.id}</td>
                                                <td>{client.name}</td>
                                                <td>{client.email}</td>
                                                <td>{client.phone}</td>
                                                <td>{client.address}</td>
                                                <td>
                                                    <button 
                                                        className="btn btn-sm btn-outline-primary me-1"
                                                        onClick={() => handleEdit(client)}
                                                    >
                                                        <i className="bi bi-pencil"></i>
                                                    </button>
                                                    <button 
                                                        className="btn btn-sm btn-outline-danger"
                                                        onClick={() => handleDelete(client.id)}
                                                    >
                                                        <i className="bi bi-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    {/* Modal de edição/criação */}
                    {showModal && (
                        <div className="modal fade show" style={{display: 'block', backgroundColor: 'rgba(0,0,0,0.5)'}}>
                            <div className="modal-dialog">
                                <div className="modal-content">
                                    <div className="modal-header">
                                        <h5 className="modal-title">
                                            {editingClient ? 'Editar Cliente' : 'Novo Cliente'}
                                        </h5>
                                        <button type="button" className="btn-close" onClick={() => setShowModal(false)}></button>
                                    </div>
                                    <form onSubmit={handleSubmit}>
                                        <div className="modal-body">
                                            <div className="mb-3">
                                                <label className="form-label">Nome</label>
                                                <input
                                                    type="text"
                                                    className="form-control"
                                                    name="name"
                                                    value={formData.name}
                                                    onChange={handleChange}
                                                    required
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">Email</label>
                                                <input
                                                    type="email"
                                                    className="form-control"
                                                    name="email"
                                                    value={formData.email}
                                                    onChange={handleChange}
                                                    required
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">Telefone</label>
                                                <input
                                                    type="text"
                                                    className="form-control"
                                                    name="phone"
                                                    value={formData.phone}
                                                    onChange={handleChange}
                                                    required
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">Endereço</label>
                                                <textarea
                                                    className="form-control"
                                                    name="address"
                                                    value={formData.address}
                                                    onChange={handleChange}
                                                    required
                                                ></textarea>
                                            </div>
                                        </div>
                                        <div className="modal-footer">
                                            <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>
                                                Cancelar
                                            </button>
                                            <button type="submit" className="btn btn-primary">
                                                {editingClient ? 'Atualizar' : 'Criar'} Cliente
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Relatorios = () => {
            const [sales] = React.useState(getData('graphica_sales'));
            const [products] = React.useState(getData('graphica_products'));
            const [startDate, setStartDate] = React.useState('');
            const [endDate, setEndDate] = React.useState('');
            
            // Calcular métricas para relatórios
            const totalSales = sales.length;
            const totalRevenue = sales.reduce((total, sale) => total + sale.total, 0);
            
            // Filtrar vendas por período
            const filteredSales = sales.filter(sale => {
                if (!startDate && !endDate) return true;
                
                const saleDate = new Date(sale.date);
                const start = startDate ? new Date(startDate) : null;
                const end = endDate ? new Date(endDate) : null;
                
                if (start && saleDate < start) return false;
                if (end && saleDate > end) return false;
                
                return true;
            });
            
            const filteredRevenue = filteredSales.reduce((total, sale) => total + sale.total, 0);
            
            // Produtos mais vendidos
            const productSales = {};
            filteredSales.forEach(sale => {
                sale.items.forEach(item => {
                    if (!productSales[item.id]) {
                        productSales[item.id] = {
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    productSales[item.id].quantity += item.quantity;
                    productSales[item.id].revenue += item.price * item.quantity;
                });
            });
            
            const topProducts = Object.values(productSales)
                .sort((a, b) => b.revenue - a.revenue)
                .slice(0, 5);
                
            React.useEffect(() => {
                // Vendas por funcionário
                const salesByEmployee = {};
    
                filteredSales.forEach(sale => {
                    const employee = sale.employee || 'Não especificado';
                    if (!salesByEmployee[employee]) {
                        salesByEmployee[employee] = 0;
                    }
                    salesByEmployee[employee] += sale.total;
                });

                const ctx = document.getElementById('categoryChart');
                if (ctx) {
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(salesByEmployee),
                            datasets: [{
                                data: Object.values(salesByEmployee),
                                backgroundColor: [
                                    '#3498db',
                                    '#2ecc71',
                                    '#e74c3c',
                                    '#f39c12',
                                    '#9b59b6'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                title: {
                                    display: true,
                                    text: 'Vendas por Funcionário'
                                }
                            }
                        }
                    });
                }
            }, [filteredSales]);

            return (
                <div>
                    <h2 className="section-title">Relatórios</h2>
                    
                    <div className="row mb-4">
                        <div className="col-md-12">
                            <div className="card">
                                <div className="card-header bg-white">
                                    <h5 className="card-title">Filtros</h5>
                                </div>
                                <div className="card-body">
                                    <div className="row">
                                        <div className="col-md-4">
                                            <label className="form-label">Data Inicial</label>
                                            <input
                                                type="date"
                                                className="form-control"
                                                value={startDate}
                                                onChange={(e) => setStartDate(e.target.value)}
                                            />
                                        </div>
                                        <div className="col-md-4">
                                            <label className="form-label">Data Final</label>
                                            <input
                                                type="date"
                                                className="form-control"
                                                value={endDate}
                                                onChange={(e) => setEndDate(e.target.value)}
                                            />
                                        </div>
                                        <div className="col-md-4 d-flex align-items-end">
                                            <button 
                                                className="btn btn-secondary"
                                                onClick={() => {
                                                    setStartDate('');
                                                    setEndDate('');
                                                }}
                                            >
                                                Limpar Filtros
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="row mb-4">
                        <div className="col-md-3 mb-3">
                            <div className="card card-dashboard bg-white">
                                <div className="card-body text-center">
                                    <h6 className="card-subtitle mb-2 text-muted">Total de Vendas</h6>
                                    <h3 className="card-title">{filteredSales.length}</h3>
                                    <p className="card-text text-muted">
                                        <small>Período selecionado</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="col-md-3 mb-3">
                            <div className="card card-dashboard bg-white">
                                <div className="card-body text-center">
                                    <h6 className="card-subtitle mb-2 text-muted">Faturamento Total</h6>
                                    <h3 className="card-title">R$ {filteredRevenue.toFixed(2)}</h3>
                                    <p className="card-text text-muted">
                                        <small>Período selecionado</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="col-md-3 mb-3">
                            <div className="card card-dashboard bg-white">
                                <div className="card-body text-center">
                                    <h6 className="card-subtitle mb-2 text-muted">Ticket Médio</h6>
                                    <h3 className="card-title">
                                        R$ {filteredSales.length > 0 ? (filteredRevenue / filteredSales.length).toFixed(2) : '0.00'}
                                    </h3>
                                    <p className="card-text text-muted">
                                        <small>Por venda</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="col-md-3 mb-3">
                            <div className="card card-dashboard bg-white">
                                <div className="card-body text-center">
                                    <h6 className="card-subtitle mb-2 text-muted">Total Geral</h6>
                                    <h3 className="card-title">R$ {totalRevenue.toFixed(2)}</h3>
                                    <p className="card-text text-muted">
                                        <small>Desde o início</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="row">
                        <div className="col-md-6 mb-4">
                            <div className="card">
                                <div className="card-header bg-white">
                                    <h5 className="card-title">Vendas por Funcionário</h5>
                                </div>
                                <div className="card-body">
                                    <canvas id="categoryChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div className="col-md-6 mb-4">
                            <div className="card">
                                <div className="card-header bg-white">
                                    <h5 className="card-title">Produtos Mais Vendidos</h5>
                                </div>
                                <div className="card-body">
                                    <ul className="list-group list-group-flush">
                                        {topProducts.map((product, index) => (
                                            <li key={index} className="list-group-item d-flex justify-content-between align-items-center">
                                                <div>
                                                    <strong>{product.name}</strong>
                                                    <br />
                                                    <small>{product.quantity} unidades vendidas</small>
                                                </div>
                                                <span className="badge bg-primary rounded-pill">
                                                    R$ {product.revenue.toFixed(2)}
                                                </span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="card">
                        <div className="card-header bg-white">
                            <h5 className="card-title">Histórico de Vendas</h5>
                        </div>
                        <div className="card-body">
                            <div className="table-responsive">
                                <table className="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Data</th>
                                            <th>Itens</th>
                                            <th>Total</th>
                                            <th>Pagamento</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {filteredSales.slice(0, 10).map(sale => (
                                            <tr key={sale.id}>
                                                <td>{sale.id}</td>
                                                <td>{new Date(sale.date).toLocaleDateString('pt-BR')}</td>
                                                <td>{sale.items.length} itens</td>
                                                <td>R$ {sale.total.toFixed(2)}</td>
                                                <td>
                                                    <span className="badge bg-secondary">
                                                        {sale.paymentMethod}
                                                    </span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Configuracoes = () => {
            const [users, setUsers] = React.useState(getData('graphica_users'));
            const [editingUser, setEditingUser] = React.useState(null);
            const [showModal, setShowModal] = React.useState(false);
            const [formData, setFormData] = React.useState({
                username: '',
                password: '',
                name: '',
                role: 'vendedor'
            });

            const handleEdit = (user) => {
                setEditingUser(user);
                setFormData({
                    username: user.username,
                    password: '',
                    name: user.name,
                    role: user.role
                });
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (window.confirm('Tem certeza que deseja excluir este usuário?')) {
                    const updatedUsers = users.filter(u => u.id !== id);
                    setUsers(updatedUsers);
                    saveData('graphica_users', updatedUsers);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (editingUser) {
                    // Editar usuário existente
                    const updatedUser = {
                        ...editingUser,
                        username: formData.username,
                        name: formData.name,
                        role: formData.role
                    };
                    
                    // Atualizar senha apenas se foi fornecida uma nova
                    if (formData.password) {
                        updatedUser.password = formData.password;
                    }
                    
                    const updatedUsers = users.map(u => 
                        u.id === editingUser.id ? updatedUser : u
                    );
                    setUsers(updatedUsers);
                    saveData('graphica_users', updatedUsers);
                } else {
                    // Adicionar novo usuário
                    const newUser = {
                        id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                        username: formData.username,
                        password: formData.password,
                        name: formData.name,
                        role: formData.role
                    };
                    const updatedUsers = [...users, newUser];
                    setUsers(updatedUsers);
                    saveData('graphica_users', updatedUsers);
                }
                
                setShowModal(false);
                setEditingUser(null);
                setFormData({
                    username: '',
                    password: '',
                    name: '',
                    role: 'vendedor'
                });
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <div>
                    <h2 className="section-title">Configurações do Sistema</h2>
                    
                    <div className="row">
                        <div className="col-md-12 mb-4">
                            <div className="card">
                                <div className="card-header bg-white d-flex justify-content-between align-items-center">
                                    <h5 className="card-title mb-0">Gerenciar Usuários</h5>
                                    <button 
                                        className="btn btn-primary btn-sm"
                                        onClick={() => {
                                            setEditingUser(null);
                                            setFormData({
                                                username: '',
                                                password: '',
                                                name: '',
                                                role: 'vendedor'
                                            });
                                            setShowModal(true);
                                        }}
                                    >
                                        <i className="bi bi-person-plus me-1"></i> Novo Usuário
                                    </button>
                                </div>
                                <div className="card-body">
                                    <div className="table-responsive">
                                        <table className="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Nome</th>
                                                    <th>Usuário</th>
                                                    <th>Função</th>
                                                    <th>Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {users.map(user => (
                                                    <tr key={user.id}>
                                                        <td>{user.id}</td>
                                                        <td>{user.name}</td>
                                                        <td>{user.username}</td>
                                                        <td>
                                                            <span className={`badge ${user.role === 'admin' ? 'bg-danger' : 'bg-secondary'}`}>
                                                                {user.role}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <button 
                                                                className="btn btn-sm btn-outline-primary me-1"
                                                                onClick={() => handleEdit(user)}
                                                            >
                                                                <i className="bi bi-pencil"></i>
                                                            </button>
                                                            {user.id !== 1 && ( // Não permitir excluir o admin principal
                                                                <button 
                                                                    className="btn btn-sm btn-outline-danger"
                                                                    onClick={() => handleDelete(user.id)}
                                                                >
                                                                    <i className="bi bi-trash"></i>
                                                                </button>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="row">
                        <div className="col-md-6 mb-4">
                            <div className="card">
                                <div className="card-header bg-white">
                                    <h5 className="card-title">Backup de Dados</h5>
                                </div>
                                <div className="card-body">
                                    <p className="card-text">Faça backup dos dados do sistema para garantir que não haja perda de informações.</p>
                                    <button className="btn btn-outline-primary">
                                        <i className="bi bi-download me-2"></i> Exportar Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div className="col-md-6 mb-4">
                            <div className="card">
                                <div className="card-header bg-white">
                                    <h5 className="card-title">Sobre o Sistema</h5>
                                </div>
                                <div className="card-body">
                                    <p className="card-text">
                                        <strong>Sistema de Caixa - Gráfica Express</strong><br />
                                        Versão 1.0.0<br />
                                        Desenvolvido para gerenciamento de vendas e estoque de gráfica rápida.
                                    </p>
                                    <div className="d-flex">
                                        <button className="btn btn-outline-secondary me-2">
                                            <i className="bi bi-question-circle me-1"></i> Ajuda
                                        </button>
                                        <button className="btn btn-outline-secondary">
                                            <i className="bi bi-info-circle me-1"></i> Sobre
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="row mt-4">
    <div className="col-12">
        <div className="card border-danger">
            <div className="card-header bg-danger text-white">
                <h5 className="card-title mb-0">
                    <i className="bi bi-exclamation-triangle-fill me-2"></i>
                    Zona de Perigo
                </h5>
            </div>
            <div className="card-body">
                <div className="row">
                    <div className="col-md-6 mb-3">
                        <div className="d-grid">
                            <button 
                                className="btn btn-outline-danger btn-lg"
                                onClick={() => {
                                    if (window.confirm('⚠️ ATENÇÃO: Isso irá apagar TODAS as vendas! Tem certeza?')) {
                                        saveData('graphica_sales', []);
                                        alert('Todas as vendas foram apagadas!');
                                    }
                                }}
                            >
                                <i className="bi bi-trash3 me-2"></i>
                                Apagar Todas as Vendas
                            </button>
                        </div>
                    </div>
                    
                    <div className="col-md-6 mb-3">
                        <div className="d-grid">
                            <button 
                                className="btn btn-outline-danger btn-lg"
                                onClick={() => {
                                    if (window.confirm('⚠️ ATENÇÃO: Isso irá apagar TODOS os registros de caixa! Tem certeza?')) {
                                        saveData('graphica_registros_caixa', []);
                                        saveData('graphica_caixa_status', false);
                                        alert('Todos os registros de caixa foram apagados!');
                                    }
                                }}
                            >
                                <i className="bi bi-trash3 me-2"></i>
                                Apagar Registros de Caixa
                            </button>
                        </div>
                    </div>
                </div>
                
                <div className="alert alert-warning mt-3">
                    <i className="bi bi-exclamation-circle me-2"></i>
                    <strong>Aviso:</strong> Estas ações são irreversíveis e devem ser usadas apenas em ambiente de teste!
                </div>
            </div>
        </div>
    </div>
</div>
                        </div>
                    </div>
                    
                    {/* Modal de edição/criação de usuário */}
                    {showModal && (
                        <div className="modal fade show" style={{display: 'block', backgroundColor: 'rgba(0,0,0,0.5)'}}>
                            <div className="modal-dialog">
                                <div className="modal-content">
                                    <div className="modal-header">
                                        <h5 className="modal-title">
                                            {editingUser ? 'Editar Usuário' : 'Novo Usuário'}
                                        </h5>
                                        <button type="button" className="btn-close" onClick={() => setShowModal(false)}></button>
                                    </div>
                                    <form onSubmit={handleSubmit}>
                                        <div className="modal-body">
                                            <div className="mb-3">
                                                <label className="form-label">Nome Completo</label>
                                                <input
                                                    type="text"
                                                    className="form-control"
                                                    name="name"
                                                    value={formData.name}
                                                    onChange={handleChange}
                                                    required
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">Nome de Usuário</label>
                                                <input
                                                    type="text"
                                                    className="form-control"
                                                    name="username"
                                                    value={formData.username}
                                                    onChange={handleChange}
                                                    required
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">
                                                    {editingUser ? 'Nova Senha (deixe em branco para manter a atual)' : 'Senha'}
                                                </label>
                                                <input
                                                    type="password"
                                                    className="form-control"
                                                    name="password"
                                                    value={formData.password}
                                                    onChange={handleChange}
                                                    required={!editingUser}
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">Função</label>
                                                <select
                                                    className="form-select"
                                                    name="role"
                                                    value={formData.role}
                                                    onChange={handleChange}
                                                    required
                                                >
                                                    <option value="vendedor">Vendedor</option>
                                                    <option value="admin">Administrador</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div className="modal-footer">
                                            <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>
                                                Cancelar
                                            </button>
                                            <button type="submit" className="btn btn-primary">
                                                {editingUser ? 'Atualizar' : 'Criar'} Usuário
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Caixa = () => {
            const [caixaAberto, setCaixaAberto] = React.useState(getData('graphica_caixa_status') || false);
            const [showModal, setShowModal] = React.useState(false);
            const [modalType, setModalType] = React.useState('');
            const [funcionarios] = React.useState(getData('graphica_users') || []);
            const today = new Date().toISOString().split('T')[0];
            
            const [formData, setFormData] = React.useState({
                funcionario: '',
                data: today,
                dinheiro: 0,
                moedas: 0,
                cartaoCredito: 0,
                cartaoDebito: 0,
                pix: 0,
                observacoes: ''
            });

            const calcularTotal = () => {
                return Number(formData.dinheiro) + Number(formData.moedas);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                const registro = {
                    data: formData.data,
                    funcionario: formData.funcionario,
                    tipo: modalType,
                    valores: {...formData},
                    totalDinheiro: calcularTotal(),
                    totalGeral: calcularTotal() + Number(formData.cartaoCredito) + Number(formData.cartaoDebito) + Number(formData.pix)
                };

                const registros = getData('graphica_registros_caixa') || [];
                saveData('graphica_registros_caixa', [...registros, registro]);
                
                setCaixaAberto(modalType === 'abrir');
                saveData('graphica_caixa_status', modalType === 'abrir');
                
                setShowModal(false);
                setFormData({
                    funcionario: '',
                    data: today,
                    dinheiro: 0,
                    moedas: 0,
                    cartaoCredito: 0,
                    cartaoDebito: 0,
                    pix: 0,
                    observacoes: ''
                });
            };

            const handleOpenClose = (tipo) => {
                setModalType(tipo);
                setShowModal(true);
            };

            return (
                <div>
                    <h2 className="section-title">Controle de Caixa</h2>
                    

<div className="row mb-4">
    <div className="col">
        <div className="card">
            <div className="card-body text-center p-4">
                <h5 className="card-title mb-4">Status do Caixa</h5>
                <div className={`alert ${caixaAberto ? 'alert-success' : 'alert-danger'} py-3 mb-4`}>
                    <h4 className="mb-0">O caixa está {caixaAberto ? 'ABERTO' : 'FECHADO'}</h4>
                </div>
                {caixaAberto ? (
                    <button 
                        className="btn btn-danger btn-lg px-5"
                        onClick={() => handleOpenClose('fechar')}
                    >
                        <i className="bi bi-lock me-2"></i> 
                        Fechar Caixa
                    </button>
                ) : (
                    <button 
                        className="btn btn-success btn-lg px-5"
                        onClick={() => handleOpenClose('abrir')}
                    >
                        <i className="bi bi-unlock me-2"></i> 
                        Abrir Caixa
                    </button>
                )}
            </div>
        </div>
    </div>

                    </div>

                    {showModal && (
                        <div className="modal fade show" style={{display: 'block', backgroundColor: 'rgba(0,0,0,0.5)'}}>
                            <div className="modal-dialog">
                                <div className="modal-content">
                                    <div className="modal-header">
                                        <h5 className="modal-title">
                                            {modalType === 'abrir' ? 'Abertura' : 'Fechamento'} de Caixa
                                        </h5>
                                        <button type="button" className="btn-close" onClick={() => setShowModal(false)}></button>
                                    </div>
                                    <form onSubmit={handleSubmit}>
                                        <div className="modal-body">
                                            
                                            {modalType === 'abrir' && (
                                                <>
                                                    <div className="mb-3">
                                                        <label className="form-label">Funcionário</label>
                                                        <select
                                                            className="form-select"
                                                            value={formData.funcionario}
                                                            onChange={(e) => setFormData({...formData, funcionario: e.target.value})}
                                                            required
                                                        >
                                                            <option value="">Selecione o funcionário</option>
                                                            {funcionarios.map(func => (
                                                                <option key={func.id} value={func.name}>
                                                                    {func.name}
                                                                </option>
                                                            ))}
                                                        </select>
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="form-label">Data</label>
                                                        <input
                                                            type="date"
                                                            className="form-control"
                                                            value={formData.data}
                                                            onChange={(e) => setFormData({...formData, data: e.target.value})}
                                                            required
                                                        />
                                                    </div>
                                                </>
                                            )}
                                            
                                            <div className="mb-3">
                                                <label className="form-label">Dinheiro em Notas</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    className="form-control"
                                                    value={formData.dinheiro}
                                                    onChange={(e) => setFormData({...formData, dinheiro: Number(e.target.value)})}
                                                    required
                                                />
                                            </div>
                                            <div className="mb-3">
                                                <label className="form-label">Dinheiro em Moedas</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    className="form-control"
                                                    value={formData.moedas}
                                                    onChange={(e) => setFormData({...formData, moedas: Number(e.target.value)})}
                                                    required
                                                />
                                            </div>
                                            
                                            {modalType === 'fechar' && (
                                                <>
                                                    <div className="mb-3">
                                                        <label className="form-label">Cartão de Crédito</label>
                                                        <input
                                                            type="number"
                                                            step="0.01"
                                                            className="form-control"
                                                            value={formData.cartaoCredito}
                                                            onChange={(e) => setFormData({...formData, cartaoCredito: Number(e.target.value)})}
                                                        />
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="form-label">Cartão de Débito</label>
                                                        <input
                                                            type="number"
                                                            step="0.01"
                                                            className="form-control"
                                                            value={formData.cartaoDebito}
                                                            onChange={(e) => setFormData({...formData, cartaoDebito: Number(e.target.value)})}
                                                        />
                                                    </div>
                                                    <div className="mb-3">
                                                        <label className="form-label">PIX</label>
                                                        <input
                                                            type="number"
                                                            step="0.01"
                                                            className="form-control"
                                                            value={formData.pix}
                                                            onChange={(e) => setFormData({...formData, pix: Number(e.target.value)})}
                                                        />
                                                    </div>
                                                </>
                                            )}
                                            
                                            <div className="mb-3">
                                                <label className="form-label">Observações</label>
                                                <textarea
                                                    className="form-control"
                                                    value={formData.observacoes}
                                                    onChange={(e) => setFormData({...formData, observacoes: e.target.value})}
                                                    rows="3"
                                                ></textarea>
                                            </div>
                                            
                                            <div className="alert alert-info">
                                                <strong>Total em Dinheiro:</strong> R$ {calcularTotal().toFixed(2)}
                                                {modalType === 'fechar' && (
                                                    <div className="mt-2">
                                                        <strong>Total Geral:</strong> R$ {(calcularTotal() + Number(formData.cartaoCredito) + Number(formData.cartaoDebito) + Number(formData.pix)).toFixed(2)}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                        <div className="modal-footer">
                                            <button type="button" className="btn btn-secondary" onClick={() => setShowModal(false)}>
                                                Cancelar
                                            </button>
                                            <button type="submit" className="btn btn-primary">
                                                {modalType === 'abrir' ? 'Abrir' : 'Fechar'} Caixa
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const RelatorioCaixa = () => {
    const [registros] = React.useState(getData('graphica_registros_caixa') || []);
    const [startDate, setStartDate] = React.useState('');
    const [endDate, setEndDate] = React.useState('');

    const filteredRegistros = registros.filter(registro => {
        if (!startDate && !endDate) return true;
        
        const registroDate = new Date(registro.data);
        const start = startDate ? new Date(startDate) : null;
        const end = endDate ? new Date(endDate) : null;
        
        if (start && registroDate < start) return false;
        if (end && registroDate > end) return false;
        
        return true;
    });

    return (
        <div>
            <h2 className="section-title">Relatório de Caixa</h2>
            
            <div className="card mb-4">
                <div className="card-body">
                    <div className="row">
                        <div className="col-md-4">
                            <label className="form-label">Data Inicial</label>
                            <input
                                type="date"
                                className="form-control"
                                value={startDate}
                                onChange={(e) => setStartDate(e.target.value)}
                            />
                        </div>
                        <div className="col-md-4">
                            <label className="form-label">Data Final</label>
                            <input
                                type="date"
                                className="form-control"
                                value={endDate}
                                onChange={(e) => setEndDate(e.target.value)}
                            />
                        </div>
                        <div className="col-md-4 d-flex align-items-end">
                            <button 
                                className="btn btn-secondary"
                                onClick={() => {
                                    setStartDate('');
                                    setEndDate('');
                                }}
                            >
                                Limpar Filtros
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div className="card">
                <div className="card-body">
                    <div className="table-responsive">
                        <table className="table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Funcionário</th>
                                    <th>Tipo</th>
                                    <th>Dinheiro</th>
                                    <th>Cartão Crédito</th>
                                    <th>Cartão Débito</th>
                                    <th>PIX</th>
                                    <th>Total</th>
                                    <th>Observações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredRegistros.map((registro, index) => (
                                    <tr key={index}>
                                        <td>{new Date(registro.data).toLocaleDateString()}</td>
                                        <td>{registro.funcionario}</td>
                                        <td>
                                            <span className={`badge ${registro.tipo === 'abrir' ? 'bg-success' : 'bg-danger'}`}>
                                                {registro.tipo === 'abrir' ? 'Abertura' : 'Fechamento'}
                                            </span>
                                        </td>
                                        <td>R$ {(Number(registro.valores.dinheiro) + Number(registro.valores.moedas)).toFixed(2)}</td>
                                        <td>R$ {Number(registro.valores.cartaoCredito).toFixed(2)}</td>
                                        <td>R$ {Number(registro.valores.cartaoDebito).toFixed(2)}</td>
                                        <td>R$ {Number(registro.valores.pix).toFixed(2)}</td>
                                        <td>R$ {registro.totalGeral.toFixed(2)}</td>
                                        <td>{registro.valores.observacoes}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    );
};

        // Componente principal da aplicação
        const App = () => {
            const [user, setUser] = React.useState(null);
            const [activeSection, setActiveSection] = React.useState('dashboard');
            const [sidebarCollapsed, setSidebarCollapsed] = React.useState(false);
            
            // Inicializar dados ao carregar a aplicação
            React.useEffect(() => {
                initializeData();
                
                // Verificar se há usuário logado no localStorage
                const loggedUser = localStorage.getItem('graphica_loggedUser');
                if (loggedUser) {
                    setUser(JSON.parse(loggedUser));
                }
            }, []);
            
            const handleLogin = (userData) => {
                setUser(userData);
                localStorage.setItem('graphica_loggedUser', JSON.stringify(userData));
            };
            
            const handleLogout = () => {
                setUser(null);
                localStorage.removeItem('graphica_loggedUser');
            };
            
            const toggleSidebar = () => {
                setSidebarCollapsed(!sidebarCollapsed);
            };
            
            if (!user) {

                return <Login onLogin={handleLogin} />;
            }

            // Atualizar renderContent
  const renderContent = () => {
    switch (activeSection) {
        case 'dashboard':
            return <Dashboard />;
        case 'vendas':
            return <Vendas user={user} />; // Passar o user como prop
        case 'produtos':
            return <Produtos />;
                            case 'relatorio-caixa':
                                return user.role === 'admin' ? <RelatorioCaixa /> : <div className="alert alert-danger">Acesso não autorizado</div>;
                            case 'relatorios':
                                return user.role === 'admin' ? <Relatorios /> : <div className="alert alert-danger">Acesso não autorizado</div>;
                            case 'configuracoes':
                                return user.role === 'admin' ? <Configuracoes /> : <div className="alert alert-danger">Acesso não autorizado</div>;
                            case 'caixa':
                                return <Caixa />;
                            default:
                                return <Dashboard />;
                        }
                    };
            
            return (
                <div className={sidebarCollapsed ? 'collapsed' : ''}>
                    <Navbar 
                        user={user} 
                        onToggleSidebar={toggleSidebar} 
                        onLogout={handleLogout} 
                    />
                    <div className="d-flex">
                        <Sidebar 
                            activeSection={activeSection} 
                            setActiveSection={setActiveSection} 
                            isCollapsed={sidebarCollapsed}
                            user={user}
                        />
                        <div className="main-content">
                            {renderContent()}
                        </div>
                    </div>
                </div>
            );
        };

        // Renderizar a aplicação
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>